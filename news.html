<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="鲁虺文化网 http://www.luhui.net 鲁虺可视化深度数据多端搜索可以将包含有明显风险的网址在不打开链接的情况下进行实时安全预览网站，从云端视觉上进行数据清洗过滤，不断用先进技术来检查关键字、词组、网址以及网站类型，尽可能筛除不适宜的内容。虽然不是100%有效的，但是采用人工细分搜索技术，可以在新闻、视频、团购、博客、游戏、论坛、小说、音乐、购物等分类目标间瞬时切换，将用户受众度最高的内容呈现在世人面前。
鲁虺搜索怀着以人文关怀之心致力于担当互联网用户与精准信息之间安全可信赖的摆渡者，鲁虺可视化深度数据多端搜索的“自由排序”技术，可以由用户自行选择按类型关联度（Relevance）或日期（Date）排列搜索结果列表的顺序，帮助用户找到最相关最新鲜的信息。">
<meta name="keywords" content="鲁虺网搜索引擎,搜索大全,搜索引擎大全,一站搜,聚合搜索,全能搜索,元搜索,搜索大全,搜索引擎大全,鲁虺搜索引擎,鲁虺可视化搜索引擎群，鲁虺搜索推广引擎">
<!-- 外部资源引入 -->
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/iconv-lite@0.6.3/dist/iconv-lite.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/encoding-japanese@2.0.0/encoding.min.js"></script>
<!-- 动态标题 -->
<title id="page-title">鲁虺文化网 http://www.luhui.net 鲁虺实用文化信息聚合搜索引擎网鲁虺人工实现的可视化多端智能大数据深度采集搜索分析优化引擎群系统 全球最好网真互动式种源文化传播交流索引平台 lǔ 鲁 huǐ 虺 wén 文 huà 化 wǎng 网</title>
<style>
/* 基础样式 */
body {
font-family: 'Segoe UI', system-ui, sans-serif;
background-color: #f8fafc;
transition: background-color 0.3s ease, color 0.3s ease;
}
/* 黑白模式样式 */
body.dark-mode {
background-color: #121212;
color: #e0e0e0;
}
body.dark-mode .bg-white { background-color: #1e1e1e; }
body.dark-mode .text-gray-800,
body.dark-mode .text-gray-900 { color: #e0e0e0; }
body.dark-mode .text-gray-700 { color: #d0d0d0; }
body.dark-mode .text-gray-600,
body.dark-mode .text-gray-500 { color: #b0b0b0; }
body.dark-mode .bg-gray-900 { background-color: #0a0a0a; }
body.dark-mode .bg-gray-200 { background-color: #333333; }
body.dark-mode .bg-gray-200:hover { background-color: #444444; }
body.dark-mode .bg-blue-50 { background-color: #1a2b4a; }
body.dark-mode .bg-green-50 { background-color: #1a4a2b; }
body.dark-mode .bg-purple-50 { background-color: #3a1a4a; }
body.dark-mode .bg-amber-50 { background-color: #4a3a1a; }
body.dark-mode .border-gray-300,
body.dark-mode .border-gray-200 { border-color: #444444; }
body.dark-mode .image-fallback {
background-color: #2d2d2d;
border-color: #555555;
color: #b0b0b0;
}
/* 内容区域样式 */
.content-container { min-height: calc(100vh - 120px); }
/* 文章卡片样式 */
.article-card { transition: all 0.3s ease; }
.article-card:hover { transform: translateY(-3px); }
/* Markdown内容样式 */
.markdown-content { line-height: 1.8; }
.markdown-content img {
max-width: 100%;
height: auto;
margin: 1.5rem auto;
border-radius: 6px;
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}
body.dark-mode .markdown-content img { filter: grayscale(100%); }
.markdown-content a { color: #2563eb; text-decoration: underline; }
body.dark-mode .markdown-content a { color: #8ab4f8; }
.markdown-content a:hover { color: #1d4ed8; }
body.dark-mode .markdown-content a:hover { color: #a8c7fa; }
.markdown-content h1, 
.markdown-content h2, 
.markdown-content h3 {
font-weight: 700;
margin-top: 1.5rem;
margin-bottom: 1rem;
color: #1e293b;
}
body.dark-mode .markdown-content h1,
body.dark-mode .markdown-content h2,
body.dark-mode .markdown-content h3 { color: #ffffff; }
.markdown-content p { margin-bottom: 1rem; }
.markdown-content ul, 
.markdown-content ol {
margin-left: 1.5rem;
margin-bottom: 1rem;
}
.markdown-content ul { list-style-type: disc; }
.markdown-content ol { list-style-type: decimal; }
.markdown-content blockquote {
border-left: 4px solid #94a3b8;
padding-left: 1rem;
margin: 1rem 0;
color: #64748b;
}
body.dark-mode .markdown-content blockquote {
border-left-color: #666666;
color: #999999;
}
.markdown-content pre {
background-color: #1e293b;
color: #f8fafc;
padding: 1rem;
border-radius: 6px;
overflow-x: auto;
margin: 1rem 0;
}
/* 加载动画 */
.loader {
width: 40px;
height: 40px;
border: 4px solid rgba(37, 99, 235, 0.2);
border-radius: 50%;
border-top-color: #2563eb;
animation: spin 1s ease-in-out infinite;
}
body.dark-mode .loader {
border-color: rgba(150, 150, 150, 0.2);
border-top-color: #aaaaaa;
}
@keyframes spin { to { transform: rotate(360deg); } }
/* 导航样式 */
.nav-link { position: relative; }
.nav-link.active::after {
content: '';
position: absolute;
bottom: -2px;
left: 0;
width: 100%;
height: 2px;
background-color: #2563eb;
}
body.dark-mode .nav-link.active::after { background-color: #8ab4f8; }
/* 图片加载失败样式 */
.image-fallback {
background-color: #f1f5f9;
border: 1px dashed #94a3b8;
display: flex;
align-items: center;
justify-content: center;
flex-direction: column;
padding: 2rem;
color: #64748b;
}
/* 搜索历史样式 */
.search-history-container { position: relative; }
.search-history-dropdown {
position: absolute;
top: 100%;
left: 0;
right: 0;
z-index: 100;
background-color: white;
border: 1px solid #e2e8f0;
border-radius: 0 0 0.5rem 0.5rem;
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
max-height: 0;
overflow: hidden;
transition: max-height 0.3s ease-out;
}
body.dark-mode .search-history-dropdown {
background-color: #1e1e1e;
border-color: #444444;
}
.search-history-dropdown.active {
max-height: 300px;
overflow-y: auto;
}
.history-header {
display: flex;
justify-content: space-between;
align-items: center;
padding: 0.75rem 1rem;
border-bottom: 1px solid #e2e8f0;
font-size: 0.875rem;
}
body.dark-mode .history-header { border-bottom-color: #444444; }
.history-title { font-weight: 500; color: #64748b; }
.clear-history {
color: #2563eb;
cursor: pointer;
font-size: 0.75rem;
}
body.dark-mode .clear-history { color: #8ab4f8; }
.clear-history:hover { color: #1d4ed8; text-decoration: underline; }
.history-list { list-style: none; margin: 0; padding: 0; }
.history-item {
padding: 0.75rem 1rem;
border-bottom: 1px solid #f1f5f9;
cursor: pointer;
transition: background-color 0.2s ease;
display: flex;
justify-content: space-between;
align-items: center;
}
body.dark-mode .history-item { border-bottom-color: #333333; }
.history-item:hover { background-color: #f8fafc; }
body.dark-mode .history-item:hover { background-color: #2d2d2d; }
.history-item:last-child { border-bottom: none; }
.history-text { color: #334155; }
body.dark-mode .history-text { color: #e0e0e0; }
.history-time {
font-size: 0.75rem;
color: #94a3b8;
margin-left: 0.5rem;
}
.remove-history {
color: #94a3b8;
cursor: pointer;
padding: 0.25rem;
opacity: 0;
transition: opacity 0.2s ease;
}
body.dark-mode .remove-history { color: #777777; }
body.dark-mode .remove-history:hover { color: #ff6b6b; }
.history-item:hover .remove-history { opacity: 1; }
.remove-history:hover { color: #ef4444; }
.no-history {
padding: 1rem;
text-align: center;
color: #94a3b8;
font-size: 0.875rem;
}
/* 黑白模式切换按钮 */
.theme-toggle {
background: none;
border: none;
cursor: pointer;
color: inherit;
display: flex;
align-items: center;
justify-content: center;
width: 40px;
height: 40px;
border-radius: 50%;
transition: background-color 0.2s ease;
}
.theme-toggle:hover { background-color: rgba(0, 0, 0, 0.1); }
body.dark-mode .theme-toggle:hover { background-color: rgba(255, 255, 255, 0.1); }
/* 内容加载失败提示 */
.content-error {
background-color: #fff3cd;
border-left: 4px solid #ffc107;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
color: #856404;
}
body.dark-mode .content-error {
background-color: #3d3511;
border-left-color: #d4a72c;
color: #e0c568;
}
/* 备用渲染样式 */
.plain-text-content {
white-space: pre-wrap;
line-height: 1.8;
word-wrap: break-word;
}
/* 加载marked.js提示 */
.marked-loading-indicator {
position: fixed;
bottom: 20px;
right: 20px;
background-color: rgba(37, 99, 235, 0.9);
color: white;
padding: 8px 12px;
border-radius: 4px;
font-size: 0.875rem;
display: flex;
align-items: center;
z-index: 1000;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}
.marked-loading-indicator .mini-loader {
width: 16px;
height: 16px;
border: 2px solid rgba(255, 255, 255, 0.3);
border-radius: 50%;
border-top-color: white;
animation: spin 1s ease-in-out infinite;
margin-right: 8px;
}
/* 搜索链接容器样式 */
#search-link-container {
transition: all 0.3s ease;
margin-bottom: 1.5rem;
padding: 1rem;
background-color: #f1f5f9;
border-radius: 0.5rem;
border: 1px solid #e2e8f0;
}
body.dark-mode #search-link-container {
background-color: #2d2d2d;
border-color: #444444;
}
body.dark-mode #search-link-container a {
color: #8ab4f8;
}
body.dark-mode #search-link-container a:hover {
color: #a8c7fa;
}
		
/* 滚动控制按钮样式 */
#scroll-controls button {
transition: all 0.3s ease;
}

#scroll-controls button:hover {
transform: scale(1.1);
}

#scroll-controls button.visible {
opacity: 1;
visibility: visible;
}

body.dark-mode #scroll-controls button {
background-color: #3b82f6;
}

body.dark-mode #scroll-controls button:hover {
background-color: #2563eb;
}


</style>
</head>
<body class="text-gray-800">


<!-- 在页脚上方添加按钮 -->
<div id="scroll-controls" class="fixed right-6 bottom-6 flex flex-col gap-3 z-40">
<button id="back-to-top-btn" class="bg-blue-600 hover:bg-blue-700 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 invisible">
<i class="fas fa-angle-double-up text-xl"></i>
</button>
<button id="back-to-bottom-btn" class="bg-blue-600 hover:bg-blue-700 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 invisible">
<i class="fas fa-angle-double-down text-xl"></i>
</button>
</div>



<!-- 顶部导航栏 -->
<header class="bg-white shadow-sm sticky top-0 z-50">
<div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
<div class="mb-4 md:mb-0">
<h1 class="text-2xl md:text-3xl font-bold text-gray-900">
<i class="fa fa-people-arrows text-blue-600 mr-2"></i>鲁虺文化网
</h1>
<p class="text-gray-500 text-sm">虺五百年化为蛟,蛟千年化为龙！</p>
</div>
<div class="flex items-center space-x-6">
<nav class="flex space-x-6">
<a href="/" class="nav-link active text-blue-600 hover:text-blue-800 transition">
<i class="fas fa-home mr-1"></i>首页
</a>
<a href="http://edu.luhui.net/" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-user-graduate mr-1"></i>学习
</a>
<a href="/cn/Works/" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-fingerprint mr-1"></i>文创
</a>
<a href="http://mil.luhui.net" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-rocket mr-1"></i>武装
<a href="/htmledit" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-satellite mr-1"></i>工具
</a>
<a href="/wap/about.html" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-address-card mr-1"></i>关于
</a>
</nav>
<!-- 黑白模式切换按钮 -->
<button id="theme-toggle" class="theme-toggle" aria-label="切换黑白模式">
<i class="fas fa-moon text-gray-600"></i>
</button>
</div>
</div>
</header>

<!-- 主内容区 -->
<main class="container mx-auto px-4 py-8 content-container">
<!-- 搜索区域 -->
<section class="mb-8 bg-white p-6 rounded-lg shadow-sm">
<div class="flex flex-col md:flex-row gap-4">
<div class="flex-grow search-history-container">
<div class="flex flex-wrap gap-4 mb-3">
<label class="inline-flex items-center cursor-pointer">
<input type="radio" name="search-type" value="title" class="form-radio text-blue-600" checked>
<span class="ml-2 text-gray-700">标题搜索</span>
</label>
<label class="inline-flex items-center cursor-pointer">
<input type="radio" name="search-type" value="content" class="form-radio text-blue-600">
<span class="ml-2 text-gray-700">内容搜索</span>
</label>
<label class="inline-flex items-center cursor-pointer">
<input type="radio" name="search-type" value="both" class="form-radio text-blue-600">
<span class="ml-2 text-gray-700">标题和内容</span>
</label>
</div>
<div class="flex gap-2">
<input type="text" id="search-input" placeholder="输入关键词搜索..." class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
<button id="search-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition flex items-center">
<i class="fas fa-search mr-2"></i>搜索
</button>
<button id="reset-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition">
<i class="fas fa-sync-alt"></i>
</button>
</div>
<!-- 搜索历史下拉框 -->
<div id="search-history" class="search-history-dropdown">
<div class="history-header">
<span class="history-title">搜索历史</span>
<span id="clear-history" class="clear-history">清除全部</span>
</div>
<ul id="history-list" class="history-list"></ul>
<div id="no-history" class="no-history hidden">暂无搜索历史</div>
</div>
</div>
</div>
</section>

<!-- 分类导航 -->
<section class="mb-8 overflow-x-auto">
<div class="flex space-x-2 md:space-x-4 min-w-max pb-2">
<button class="category-btn active px-4 py-2 bg-blue-600 text-white rounded-lg transition" data-category="all">全部内容
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./groups/copywriter">
商业文案
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./groups/cultureknowledge">
文化常识
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./grphp/poeticessay">
诗词歌赋
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./cn/soft/development">
软件开发</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./luhuiIntegratedDataCenter/design">
设计智造
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./url/domainname">
网络域名
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./cn/host/maintenance">
建站运营
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./cn/seo/searchoptimization">
搜索优化
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./cn/code/codesevaluation">
源码测评
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./video/cutavideo">
视频剪辑
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./lyrics/audioediting">
录音剪辑
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./include/spaceexploration">
宇宙探索
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./intl/languagetranslation">
语言翻译
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./service/convenientservices">
便民服务
</button>

<button class="category-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition" data-category="./cn/law/lawsregulations">
法律法规
</button>
</div>
</section>

<!-- 统计信息 -->
<section id="stats-section" class="mb-8 bg-white p-6 rounded-lg shadow-sm">
<h2 class="text-xl font-semibold mb-4 text-gray-800">
<i class="fas fa-chart-pie text-blue-600 mr-2"></i>内容统计
</h2>
</a>
<a href="http://web.luhui.net" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-link mr-1"></i>网站推荐
</a>
<a href="http://search.luhui.net" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-search mr-1"></i>搜索
</a>
<a href="http://zhongyi.luhui.net" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-medkit mr-1"></i>中医
</a>
<a href="http://piano.luhui.net" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-music mr-1"></i>抚琴
</a>
<a href="http://qi.luhui.net" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-keyboard mr-1"></i>棋迷
</a>
<a href="http://book.luhui.net" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-book mr-1"></i>书库
</a>
<a href="http://images.luhui.net" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-image mr-1"></i>画图
</a>
<a href="http://game.luhui.net" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-gamepad mr-1"></i>游玩
</a>
<a href="http://law.luhui.net" class="nav-link text-gray-600 hover:text-blue-600 transition">
<i class="fa fa-balance-scale mr-1"></i>法律
</a>
<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
<div class="bg-blue-50 p-4 rounded-lg">
<p class="text-sm text-gray-500 mb-1">总文章数</p>
<p id="total-articles" class="text-2xl font-bold text-blue-600">0</p>
</div>
<div class="bg-green-50 p-4 rounded-lg">
<p class="text-sm text-gray-500 mb-1">资讯文章</p>
<p id="news-articles" class="text-2xl font-bold text-green-600">0</p>
</div>
<div class="bg-purple-50 p-4 rounded-lg">
<p class="text-sm text-gray-500 mb-1">教程文章</p>
<p id="tutorial-articles" class="text-2xl font-bold text-purple-600">0</p>
</div>
<div class="bg-amber-50 p-4 rounded-lg">
<p class="text-sm text-gray-500 mb-1">资源文章</p>
<p id="resource-articles" class="text-2xl font-bold text-amber-600">0</p>
</div>
</div>
</section>

<!-- 加载状态 -->
<section id="loading-section" class="mb-8 hidden">
<div class="flex flex-col items-center justify-center py-12 bg-white rounded-lg shadow-sm">
<div class="loader mb-4"></div>
<p class="text-gray-600">正在加载内容，请稍候...</p>
<p id="loading-detail" class="text-gray-500 text-sm mt-2">准备加载文章数据</p>
</div>
</section>

<!-- 错误信息 -->
<section id="error-section" class="mb-8 hidden">
<div class="bg-red-50 border border-red-200 p-6 rounded-lg">
<div class="flex items-start">
<i class="fas fa-exclamation-circle text-red-500 text-xl mt-0.5 mr-3"></i>
<div>
<h3 class="font-medium text-red-800 mb-1">加载失败</h3>
<p id="error-message" class="text-red-700">无法加载内容，请稍后重试</p>
<button id="retry-btn" class="mt-3 text-sm text-red-600 hover:text-red-800 font-medium">
<i class="fas fa-redo-alt mr-1"></i>重试
</button>
</div>
</div>
</div>
</section>

<!-- 文章列表 -->
<section id="articles-section">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-semibold text-gray-800">
<i class="fas fa-list-alt text-blue-600 mr-2"></i>文章列表
</h2>
<div class="text-sm text-gray-500">
找到 <span id="articles-count">0</span> 篇文章
</div>
</div>
<div id="articles-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

<!-- 空状态 -->
<div id="empty-state" class="hidden py-16 text-center bg-white rounded-lg shadow-sm">
<i class="fas fa-file-search text-gray-300 text-5xl mb-4"></i>
<h3 class="text-lg font-medium text-gray-700 mb-2">未找到相关文章</h3>
<p class="text-gray-500 max-w-md mx-auto">尝试使用不同的搜索词或浏览其他分类</p>
<button id="empty-reset-btn" class="mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">
查看全部文章
</button>
</div>

<!-- 分页控件 -->
<div id="pagination" class="mt-8 flex justify-center items-center gap-2 flex-wrap">
<button id="prev-page" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
<i class="fas fa-chevron-left mr-1"></i>上一页
</button>
<div id="page-numbers" class="flex gap-1"></div>
<button id="next-page" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
下一页<i class="fas fa-chevron-right ml-1"></i>
</button>
</div>
</section>

<!-- 文章详情 -->
<section id="article-detail">
<button id="back-to-list" class="mb-6 inline-flex items-center px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition">
<i class="fas fa-arrow-left mr-2"></i>返回列表
</button>

<!-- 详情加载状态 -->
<div id="detail-loading" class="hidden bg-white rounded-lg shadow-sm overflow-hidden mb-6 p-8">
<div class="flex flex-col items-center justify-center py-12">
<div class="loader mb-4"></div>
<p class="text-gray-600">正在加载文章内容，请稍候...</p>
</div>
</div>

<!-- 详情内容容器 -->
<article id="detail-content-container" class="bg-white rounded-lg shadow-sm overflow-hidden mb-6 hidden">
<div class="p-6 md:p-8">
<div class="mb-4 flex items-center text-sm text-gray-500">
<span class="inline-flex items-center mr-4">
<i class="fas fa-folder-open mr-1"></i>
<span id="detail-category"></span>
</span>
<span class="inline-flex items-center">
<i class="fas fa-file-code mr-1"></i>
<span id="detail-id"></span>
</span>
</div>
<h1 id="detail-title" class="text-2xl md:text-3xl font-bold text-gray-900 mb-6"></h1>

<!-- 搜索看看链接（基于当前文章标题） -->
<div id="search-link-container">
搜索看看 <a id="article-search-link" href="" target="_blank" class="text-blue-600 hover:underline"></a>         在鲁虺群搜索看看更多资源链接
</div>

<!-- 内容渲染容器 -->
<div id="detail-content-container-inner" class="markdown-content"></div>

<!-- 渲染错误提示 -->
<div id="render-error-container" class="hidden mt-4">
<div class="bg-amber-50 border-l-4 border-amber-400 p-4">
<div class="flex">
<div class="flex-shrink-0">
<i class="fas fa-exclamation-triangle text-amber-500"></i>
</div>
<div class="ml-3">
<p class="text-sm text-amber-700">Markdown渲染失败，已自动切换为纯文本显示。</p>
<div class="mt-2 text-sm">
<button id="retry-render-btn" class="text-amber-600 hover:text-amber-800">
<i class="fas fa-redo-alt mr-1"></i>重试渲染
</button>
<button id="use-basic-renderer-btn" class="text-amber-600 hover:text-amber-800 ml-3">
<i class="fas fa-pencil-alt mr-1"></i>使用基础渲染器
</button>
</div>
</div>
</div>
</div>
</div>
</div>
</article>

<!-- 详情错误状态 -->
<div id="detail-error" class="hidden bg-white rounded-lg shadow-sm overflow-hidden mb-6 p-8">
<div class="bg-red-50 border border-red-200 p-6 rounded-lg">
<div class="flex items-start">
<i class="fas fa-exclamation-circle text-red-500 text-xl mt-0.5 mr-3"></i>
<div>
<h3 class="font-medium text-red-800 mb-1">加载文章失败</h3>
<p id="detail-error-message" class="text-red-700">无法加载文章内容，请稍后重试</p>
<button id="detail-retry-btn" class="mt-3 text-sm text-red-600 hover:text-red-800 font-medium">
<i class="fas fa-redo-alt mr-1"></i>重试
</button>
<button id="show-plaintext-btn" class="mt-3 text-sm text-red-600 hover:text-red-800 font-medium ml-3">
<i class="fas fa-file-alt mr-1"></i>查看纯文本
</button>
</div>
</div>
</div>
</div>

<!-- 上下篇导航 -->
<div class="flex justify-between">
<button id="prev-article" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
<i class="fas fa-chevron-left mr-2"></i>上一篇
</button>
<button id="next-article" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
下一篇<i class="fas fa-chevron-right ml-2"></i>
</button>
</div>
</section>
</main>

<!-- 页脚 -->
<footer class="bg-gray-900 text-gray-300 py-8">
<div class="container mx-auto px-4">
<div class="flex flex-col md:flex-row justify-between items-center">
<div class="mb-4 md:mb-0">
<h3 class="text-xl font-bold text-white mb-2">鲁虺文化资源网</h3>
<p class="text-sm">携手鲁虺，智创美好！</p>
</div>
<div class="flex space-x-4">
<a href="tel:+86 13386070835" class="text-gray-400 hover:text-white transition">
<i class="fas fa-phone"></i>
</a>
<a href="/cn/mail/" class="text-gray-400 hover:text-white transition">
<i class="fas fa-envelope"></i>
</a>
<a href="/cn/fy" class="text-gray-400 hover:text-white transition">
<i class="fas fa-globe"></i>
</a>
<a href="/cs/" class="text-gray-400 hover:text-white transition">
<i class="fas fa-archive"></i>
</a>
</div>
</div>
<div class="border-t border-gray-800 mt-6 pt-6 text-center text-sm">
<p>鲁虺文化网-驾驭网络，共创神奇！</p>
</div>
<div class="footer-inner mt-6">
<p align="center"> Copyright &copy; 2004-01-11&nbsp;<a href="http://luhui.net" title="鲁虺文化网" target="_top">luhui.net</a>&nbsp;all rights reserved.</p>	
<div id="back-to-top-btn" style="display:none;"><i class="fas fa-angle-double-up" style="font-size: 25px;"></i></div>
</div>
</div>
</footer>

<!-- marked.js加载指示器 -->
<div id="marked-loading-indicator" class="marked-loading-indicator hidden">
<div class="mini-loader"></div>
<span>正在加载内容渲染组件...</span>
</div>

<script>
// 配置与状态管理
const config = {
baseUrl: '',
imageBasePath: '/luhuitxtcms/',
itemsPerPage: 12,
maxDetectionAttempts: 100,
timeout: 15000,
maxSearchHistory: 10,
categories: {
'./groups/copywriter': '商业文案',
'./groups/cultureknowledge': '文化常识',
'./grphp/poeticessay': '诗词歌赋',
'./cn/soft/development': '软件开发',
'./luhuiIntegratedDataCenter/design': '设计智造',
'./url/domainname': '网络域名',
'./cn/host/maintenance': '建站运营',
'./cn/seo/searchoptimization': '搜索优化',
'./cn/code/codesevaluation': '源码测评',
'./video/cutavideo': '视频剪辑',
'./lyrics/audioediting': '录音剪辑',
'./include/spaceexploration': '宇宙探索',
'./intl/languagetranslation': '语言翻译',
'./service/convenientservices': '便民服务',
'./cn/law/lawsregulations': '法律法规'
},
supportedEncodings: ['utf8', 'gbk', 'gb2312', 'iso-8859-1', 'iso-8859-2', 'big5', 'euc-kr', 'shift-jis'],
markedCdnUrls: [
'https://cdn.jsdelivr.net/npm/marked/marked.min.js',
'https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js',
'https://unpkg.com/marked@4.0.2/marked.min.js'
]
};

const state = {
currentCategory: 'all',
currentPage: 1,
searchTerm: '',
searchType: 'title',
totalArticles: 0,
totalPages: 0,
allArticles: [],
filteredArticles: [],
articleCache: new Map(),
categoryCounts: {},
searchHistory: [],
darkMode: false,
markedRenderer: null,
markedLoaded: false,
usingFallbackRenderer: false,
currentArticle: null // 当前显示的文章
};

// DOM元素映射
const elements = {
// 主题切换
themeToggle: document.getElementById('theme-toggle'),
// 搜索相关
searchInput: document.getElementById('search-input'),
searchBtn: document.getElementById('search-btn'),
resetBtn: document.getElementById('reset-btn'),
searchTypeRadios: document.querySelectorAll('input[name="search-type"]'),
// 搜索历史相关
searchHistoryDropdown: document.getElementById('search-history'),
historyList: document.getElementById('history-list'),
clearHistoryBtn: document.getElementById('clear-history'),
noHistoryMsg: document.getElementById('no-history'),
// 分类相关
categoryBtns: document.querySelectorAll('.category-btn'),
// 内容区域
articlesGrid: document.getElementById('articles-grid'),
articlesCount: document.getElementById('articles-count'),
emptyState: document.getElementById('empty-state'),
emptyResetBtn: document.getElementById('empty-reset-btn'),
// 加载与错误状态
loadingSection: document.getElementById('loading-section'),
loadingDetail: document.getElementById('loading-detail'),
errorSection: document.getElementById('error-section'),
errorMessage: document.getElementById('error-message'),
retryBtn: document.getElementById('retry-btn'),
// 分页
pagination: document.getElementById('pagination'),
prevPageBtn: document.getElementById('prev-page'),
nextPageBtn: document.getElementById('next-page'),
pageNumbers: document.getElementById('page-numbers'),
// 统计信息
totalArticles: document.getElementById('total-articles'),
newsArticles: document.getElementById('news-articles'),
tutorialArticles: document.getElementById('tutorial-articles'),
resourceArticles: document.getElementById('resource-articles'),
// 文章详情
articlesSection: document.getElementById('articles-section'),
articleDetail: document.getElementById('article-detail'),
backToListBtn: document.getElementById('back-to-list'),
detailTitle: document.getElementById('detail-title'),
detailContentInner: document.getElementById('detail-content-container-inner'),
detailCategory: document.getElementById('detail-category'),
detailId: document.getElementById('detail-id'),
prevArticleBtn: document.getElementById('prev-article'),
nextArticleBtn: document.getElementById('next-article'),
// 渲染错误相关
renderErrorContainer: document.getElementById('render-error-container'),
retryRenderBtn: document.getElementById('retry-render-btn'),
useBasicRendererBtn: document.getElementById('use-basic-renderer-btn'),
// 详情页加载和错误状态
detailLoading: document.getElementById('detail-loading'),
detailContentContainer: document.getElementById('detail-content-container'),
detailError: document.getElementById('detail-error'),
detailErrorMessage: document.getElementById('detail-error-message'),
detailRetryBtn: document.getElementById('detail-retry-btn'),
showPlaintextBtn: document.getElementById('show-plaintext-btn'),
// Marked加载指示器
markedLoadingIndicator: document.getElementById('marked-loading-indicator'),
// 动态标题和搜索链接元素
pageTitle: document.getElementById('page-title'),
searchLinkContainer: document.getElementById('search-link-container'),
articleSearchLink: document.getElementById('article-search-link')
};

// 动态更新页面标题（根据分类/文章状态）
function updatePageTitle() {
const baseTitle = "鲁虺文化网 http://www.luhui.net 鲁虺实用文化信息聚合搜索引擎网鲁虺人工实现的可视化多端智能大数据深度采集搜索分析优化引擎群系统 全球最好网真互动式种源文化传播交流索引平台 lǔ 鲁 huǐ 虺 wén 文 huà 化 wǎng 网";

// 校验必要元素
if (!elements.pageTitle) return;

// 场景1：查看特定文章（优先显示文章标题）
if (state.currentArticle) {
elements.pageTitle.textContent = `${state.currentArticle.title} - ${baseTitle}`;
// 同步更新搜索链接（编码标题防止特殊字符问题）
if (elements.articleSearchLink) {
const encodedTitle = encodeURIComponent(state.currentArticle.title);
elements.articleSearchLink.href = `http://search.luhui.net/?q=${encodedTitle}`;
elements.articleSearchLink.textContent = state.currentArticle.title;
}
// 显示搜索链接容器（仅文章详情页需要）
if (elements.searchLinkContainer) {
elements.searchLinkContainer.classList.remove('hidden');
}
} 
// 场景2：浏览特定分类（显示分类名称）
else if (state.currentCategory && state.currentCategory !== 'all') {
const categoryName = config.categories[state.currentCategory] || state.currentCategory;
elements.pageTitle.textContent = `${categoryName} - ${baseTitle}`;
// 隐藏搜索链接容器
if (elements.searchLinkContainer) {
elements.searchLinkContainer.classList.add('hidden');
}
} 
// 场景3：首页/默认状态（显示基础标题）
else {
elements.pageTitle.textContent = baseTitle;
// 隐藏搜索链接容器
if (elements.searchLinkContainer) {
elements.searchLinkContainer.classList.add('hidden');
}
}
}

// 加载marked.js库
async function loadMarkedLibrary() {
if (window.marked) {
state.markedLoaded = true;
return true;
}
elements.markedLoadingIndicator.classList.remove('hidden');

for (const url of config.markedCdnUrls) {
try {
const script = document.createElement('script');
script.src = url;
script.integrity = url.includes('cdn.jsdelivr.net') ? 'sha256-EGkF67+wL2NqgM7UeA1tM52Bx5j5tQl3Zp9V4qM2aZg=' : '';
script.crossOrigin = 'anonymous';

const loadPromise = new Promise((resolve, reject) => {
const timeoutId = setTimeout(() => reject(new Error('加载超时')), 10000);
script.onload = () => {
clearTimeout(timeoutId);
resolve();
};
script.onerror = () => {
clearTimeout(timeoutId);
reject(new Error('加载失败'));
};
});

document.head.appendChild(script);
await loadPromise;

if (window.marked && typeof window.marked === 'function') {
state.markedLoaded = true;
elements.markedLoadingIndicator.classList.add('hidden');
return true;
}
} catch (error) {
console.error(`加载marked.js失败 (${url}):`, error);
continue;
}
}

console.warn('所有marked.js CDN加载失败，将使用备用渲染器');
state.usingFallbackRenderer = true;
elements.markedLoadingIndicator.classList.add('hidden');
return false;
}

// 初始化marked渲染器
async function initMarkedRenderer() {
if (state.usingFallbackRenderer) return;
if (window.marked) {
try {
const renderer = new marked.Renderer();
// 自定义图片渲染
renderer.image = function(href, title, text) {
let imageUrl = href;
if (href && !href.startsWith('http://') && !href.startsWith('https://') && !href.startsWith('/')) {
const urlParams = new URLSearchParams(window.location.search);
const category = urlParams.get('category');
if (category && config.categories[category]) {
imageUrl = `${config.imageBasePath}${category}/${href}`;
} else {
imageUrl = `${config.imageBasePath}${href}`;
}
}
const titleAttr = title ? `title="${title}"` : '';
return `<img src="${imageUrl}" alt="${text}" ${titleAttr} loading="lazy" onerror="this.onerror=null;this.outerHTML='<div class=\'image-fallback\'><i class=\'fas fa-image mb-2\'></i><p>图片加载失败</p><p class=\'text-xs\'>${text}</p></div>'">`;
};
// 自定义链接渲染
renderer.link = function(href, title, text) {
const titleAttr = title ? `title="${title}"` : '';
const isExternal = href && (href.startsWith('http://') || href.startsWith('https://'));
const targetAttr = isExternal ? 'target="_blank" rel="noopener noreferrer"' : '';
return `<a href="${href}" ${titleAttr} ${targetAttr}>${text}</a>`;
};

state.markedRenderer = renderer;
marked.setOptions({ breaks: true, gfm: true, renderer: state.markedRenderer });
console.log('marked.js 初始化成功');
} catch (error) {
console.error('marked.js 初始化失败:', error);
state.usingFallbackRenderer = true;
}
} else {
console.warn('marked.js 未加载，将使用备用渲染器');
state.usingFallbackRenderer = true;
}
}

// 基础备用渲染器
function basicMarkdownRenderer(text) {
if (!text) return '';
let html = text;
// 处理标题
html = html.replace(/^(#{1,6})\s+(.*?)$/gm, (match, hashes, title) => {
const level = hashes.length;
return `<h${level} class="font-bold mt-4 mb-2">${title}</h${level}>`;
});
// 处理粗体/斜体
html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
html = html.replace(/__(.*?)__/g, '<strong>$1</strong>');
html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
html = html.replace(/_(.*?)_/g, '<em>$1</em>');
// 处理链接
html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
// 处理图片
html = html.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, (match, alt, src) => {
let imageUrl = src;
if (src && !src.startsWith('http://') && !src.startsWith('https://') && !src.startsWith('/')) {
if (state.currentArticle && state.currentArticle.category) {
imageUrl = `${config.imageBasePath}${state.currentArticle.category}/${src}`;
} else {
imageUrl = `${config.imageBasePath}${src}`;
}
}
return `<img src="${imageUrl}" alt="${alt}" loading="lazy" onerror="this.onerror=null;this.outerHTML='<div class=\'image-fallback\'><i class=\'fas fa-image mb-2\'></i><p>图片加载失败</p><p class=\'text-xs\'>${alt}</p></div>'">`;
});
// 处理列表
html = processLists(html);
// 处理代码块
html = html.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
html = html.replace(/`(.*?)`/g, '<code>$1</code>');
// 处理引用
html = html.replace(/^> (.*?)$/gm, '<blockquote>$1</blockquote>');
// 处理换行
html = html.replace(/\n\n/g, '</p><p>');
html = html.replace(/\n/g, '<br>');
// 添加段落标签
if (!html.startsWith('<p>')) {
html = `<p>${html}</p>`;
}
return html;
}

// 处理列表渲染
function processLists(html) {
const lines = html.split('\n');
let inUnorderedList = false;
let inOrderedList = false;
let result = [];

lines.forEach(line => {
if (line.trim().startsWith('* ') || line.trim().startsWith('- ')) {
const text = line.trim().substring(2);
if (!inUnorderedList) {
result.push('<ul>');
inUnorderedList = true;
}
if (inOrderedList) {
result.push('</ol>');
inOrderedList = false;
}
result.push(`<li>${text}</li>`);
} else if (/^\d+\. /.test(line.trim())) {
const text = line.trim().replace(/^\d+\. /, '');
if (!inOrderedList) {
result.push('<ol>');
inOrderedList = true;
}
if (inUnorderedList) {
result.push('</ul>');
inUnorderedList = false;
}
result.push(`<li>${text}</li>`);
} else {
if (inUnorderedList) {
result.push('</ul>');
inUnorderedList = false;
}
if (inOrderedList) {
result.push('</ol>');
inOrderedList = false;
}
result.push(line);
}
});

if (inUnorderedList) result.push('</ul>');
if (inOrderedList) result.push('</ol>');
return result.join('\n');
}

// 从URL参数加载状态
function loadStateFromUrl() {
const cleanUrl = window.location.search.replace(/%20/g, '').replace(/\s+/g, '');
const urlParams = new URLSearchParams(cleanUrl);
let category = urlParams.get('category') || '';
category = category.trim();
const articleId = urlParams.get('id');
const page = parseInt(urlParams.get('p')) || 1;
const search = urlParams.get('q') || '';

// 验证分类参数
const validCategories = Object.keys(config.categories);
let normalizedCategory = category;
if (category && !validCategories.includes(category)) {
const similarCategory = findSimilarCategory(category, validCategories);
normalizedCategory = similarCategory || 'all';
}

// 应用参数
if (normalizedCategory && config.categories[normalizedCategory]) {
state.currentCategory = normalizedCategory;
updateCategoryButtons();
}
if (page > 1) state.currentPage = page;
if (search) {
elements.searchInput.value = search;
state.searchTerm = search;
}

// 处理文章详情跳转
if (normalizedCategory && articleId) {
const showDetail = async () => {
if (state.allArticles.length === 0) {
setTimeout(showDetail, 100);
return;
}
await viewArticleDetail(normalizedCategory, articleId);
};
showDetail();
} else {
elements.articleDetail.classList.add('hidden');
elements.articlesSection.classList.remove('hidden');
updatePageTitle(); // 初始化列表页标题
}
}

// 查找相似分类（修复拼写错误）
function findSimilarCategory(input, validCategories) {
input = input.toLowerCase();
// 检查子串匹配
for (const category of validCategories) {
if (input.length === category.length + 1 && input.includes(category)) return category;
if (category.length === input.length + 1 && category.includes(input)) return category;
}
// 检查大小写匹配
for (const category of validCategories) {
if (category.toLowerCase() === input) return category;
}
return null;
}

// 更新URL参数
function updateUrl() {
const params = new URLSearchParams();
if (state.currentCategory !== 'all') params.append('category', state.currentCategory);
if (state.currentPage > 1) params.append('p', state.currentPage);
if (state.searchTerm) params.append('q', state.searchTerm);
const newUrl = params.toString() ? `?${params.toString()}` : window.location.pathname;
window.history.pushState({}, '', newUrl);
}

// 绑定所有事件
function bindEvents() {
// 主题切换
elements.themeToggle.addEventListener('click', toggleTheme);
// 搜索事件
elements.searchBtn.addEventListener('click', handleSearch);
elements.searchInput.addEventListener('keypress', (e) => e.key === 'Enter' && handleSearch());
// 重置搜索
elements.resetBtn.addEventListener('click', resetSearch);
elements.emptyResetBtn.addEventListener('click', resetSearch);
// 搜索类型切换
elements.searchTypeRadios.forEach(radio => {
radio.addEventListener('change', (e) => {
state.searchType = e.target.value;
filterAndDisplayArticles();
});
});
// 分类切换
elements.categoryBtns.forEach(btn => {
btn.addEventListener('click', (e) => {
const category = e.target.dataset.category;
if (category) {
state.currentCategory = category;
state.currentPage = 1;
updateCategoryButtons();
filterAndDisplayArticles();
updateUrl();
updatePageTitle(); // 切换分类后更新标题
}
});
});
// 分页事件
elements.prevPageBtn.addEventListener('click', () => {
if (state.currentPage > 1) {
state.currentPage--;
displayCurrentPageArticles();
updatePagination();
updateUrl();
}
});
elements.nextPageBtn.addEventListener('click', () => {
if (state.currentPage < state.totalPages) {
state.currentPage++;
displayCurrentPageArticles();
updatePagination();
updateUrl();
}
});
// 重试加载
elements.retryBtn.addEventListener('click', async () => await loadAllArticles());
elements.detailRetryBtn.addEventListener('click', async () => {
const currentUrl = new URL(window.location.href);
const category = currentUrl.searchParams.get('category');
const id = currentUrl.searchParams.get('id');
if (category && id) await viewArticleDetail(category, id, true);
});
// 显示纯文本
elements.showPlaintextBtn.addEventListener('click', () => {
if (state.currentArticle) {
elements.detailContentInner.innerHTML = `<div class="plain-text-content text-gray-700">${escapeHtml(state.currentArticle.content)}</div>`;
elements.detailError.classList.add('hidden');
elements.detailContentContainer.classList.remove('hidden');
}
});
// 重试渲染
elements.retryRenderBtn.addEventListener('click', async () => {
elements.renderErrorContainer.classList.add('hidden');
await loadMarkedLibrary();
await initMarkedRenderer();
if (state.currentArticle) renderArticleContent(state.currentArticle);
});
// 使用基础渲染器
elements.useBasicRendererBtn.addEventListener('click', () => {
if (state.currentArticle) {
state.usingFallbackRenderer = true;
renderArticleContent(state.currentArticle);
}
});
// 返回列表
elements.backToListBtn.addEventListener('click', () => {
elements.articleDetail.classList.add('hidden');
elements.articlesSection.classList.remove('hidden');
updateUrl();
window.scrollTo(0, 0);
state.currentArticle = null; // 清除当前文章状态
updatePageTitle(); // 恢复列表页标题
});
// 搜索历史事件
elements.searchInput.addEventListener('focus', showSearchHistory);
elements.searchInput.addEventListener('input', filterSearchHistory);
document.addEventListener('click', (e) => {
if (!elements.searchInput.contains(e.target) && !elements.searchHistoryDropdown.contains(e.target)) {
hideSearchHistory();
}
});
elements.clearHistoryBtn.addEventListener('click', (e) => {
e.stopPropagation();
clearAllSearchHistory();
});
}

// 渲染文章内容
function renderArticleContent(article) {
state.currentArticle = article;
try {
if (!article.content.trim()) {
elements.detailContentInner.innerHTML = `
<div class="content-error">
<p><i class="fas fa-exclamation-triangle mr-1"></i> 注意：这篇文章没有内容。</p>
</div>
`;
return true;
}

let htmlContent = '';
if (state.usingFallbackRenderer || !window.marked || !state.markedRenderer) {
htmlContent = basicMarkdownRenderer(article.content);
} else {
htmlContent = marked.parse(article.content, { renderer: state.markedRenderer });
}

elements.detailContentInner.innerHTML = `<div class="markdown-content text-gray-700">${htmlContent}</div>`;
elements.renderErrorContainer.classList.add('hidden');
return true;
} catch (error) {
console.error('内容渲染失败:', error);
if (error.message && error.message.includes('this.renderer.paragraph is not a function')) {
state.usingFallbackRenderer = true;
return renderArticleContent(article);
}
// 显示纯文本备用
elements.detailContentInner.innerHTML = `<div class="plain-text-content text-gray-700">${escapeHtml(article.content)}</div>`;
elements.renderErrorContainer.classList.remove('hidden');
return false;
}
}

// HTML转义（纯文本显示用）
function escapeHtml(unsafe) {
if (!unsafe) return '';
return unsafe
.replace(/&/g, "&amp;")
.replace(/</g, "&lt;")
.replace(/>/g, "&gt;")
.replace(/"/g, "&quot;")
.replace(/'/g, "&#039;");
}

// 编码检测与转换
function decodeText(buffer, encodings = config.supportedEncodings) {
for (const encoding of encodings) {
try {
if (encoding === 'shift-jis') {
const array = new Uint8Array(buffer);
const decoded = Encoding.convert(array, { to: 'UTF8', from: 'SJIS' });
return new TextDecoder('utf-8').decode(decoded);
}
if (encoding === 'euc-kr') {
const array = new Uint8Array(buffer);
const decoded = Encoding.convert(array, { to: 'UTF8', from: 'EUC-KR' });
return new TextDecoder('utf-8').decode(decoded);
}
return iconvLite.decode(Buffer.from(buffer), encoding);
} catch (e) {
console.log(`使用${encoding}解码失败:`, e.message);
continue;
}
}
// 最终备用：UTF-8替换模式
try {
return new TextDecoder('utf-8', { fatal: false }).decode(buffer);
} catch (e) {
console.error('所有编码解码均失败', e);
return '';
}
}

// 加载文章内容
async function loadArticleContent(category, id) {
const cacheKey = `${category}-${id}`;
if (state.articleCache.has(cacheKey)) {
console.log(`从缓存加载文章: ${category}/${id}.txt`);
return state.articleCache.get(cacheKey);
}

const url = `${config.baseUrl}${category}/${id}.txt`;
console.log(`加载文章: ${url}`);
try {
const response = await fetch(url, {
method: 'GET',
cache: 'no-cache',
headers: { 'Accept': 'text/plain; charset=*' }
});

if (!response.ok) throw new Error(`HTTP错误: ${response.status}，无法加载文件`);
const buffer = await response.arrayBuffer();
const content = decodeText(buffer);

if (!content.trim()) throw new Error('文章内容为空');
const lines = content.split('\n');
const title = lines[0] ? lines[0].trim() : `未命名文章 (${category}-${id})`;
const body = lines.slice(1).join('\n').trim();

const article = { id, category, title, content: body, fullContent: content };
state.articleCache.set(cacheKey, article);
return article;
} catch (error) {
console.error(`加载文章 ${category}/${id}.txt 失败:`, error);
throw error;
}
}

// 检测并加载分类文章
async function detectAndLoadCategoryArticles(category) {
const articles = [];
let attempts = 0;
while (attempts < config.maxDetectionAttempts) {
attempts++;
const articleId = attempts;
try {
elements.loadingDetail.textContent = `正在加载 ${config.categories[category]} (${articleId}/${config.maxDetectionAttempts})`;
const article = await Promise.race([
loadArticleContent(category, articleId),
new Promise((_, reject) => setTimeout(() => reject(new Error('加载超时')), config.timeout))
]);
articles.push(article);
state.categoryCounts[category]++;
console.log(`成功加载 ${category}/${articleId}.txt`);
} catch (error) {
if (attempts > 3) break;
console.log(`尝试加载 ${category}/${articleId}.txt 失败，继续尝试...`);
}
}
console.log(`完成加载 ${category} 分类，共 ${articles.length} 篇文章`);
return articles;
}

// 加载所有文章
async function loadAllArticles() {
showLoading('开始加载文章数据...');
hideError();
state.allArticles = [];
state.categoryCounts = {};

try {
// 初始化分类计数
Object.keys(config.categories).forEach(category => {
state.categoryCounts[category] = 0;
});

// 并发加载所有分类
const categoryPromises = Object.keys(config.categories).map(category => detectAndLoadCategoryArticles(category));
const results = await Promise.all(categoryPromises);

// 合并并排序文章
results.forEach(articles => state.allArticles.push(...articles));
state.allArticles.sort((a, b) => {
if (a.category !== b.category) return a.category.localeCompare(b.category);
return parseInt(a.id) - parseInt(b.id);
});

// 更新统计与显示
updateStatistics();
filterAndDisplayArticles();
updatePageTitle(); // 加载完成后更新标题
hideLoading();
} catch (error) {
console.error('加载文章失败:', error);
hideLoading();
showError(`加载文章时发生错误: ${error.message}`);
}
}

// 更新统计信息
function updateStatistics() {
const total = state.allArticles.length;
elements.totalArticles.textContent = total;

// 简单分类统计（实际应用中可能需要更复杂的分类逻辑）
const newsCount = Math.floor(total * 0.6);
const tutorialCount = Math.floor(total * 0.2);
const resourceCount = total - newsCount - tutorialCount;

elements.newsArticles.textContent = newsCount;
elements.tutorialArticles.textContent = tutorialCount;
elements.resourceArticles.textContent = resourceCount;
}

// 过滤并显示文章
function filterAndDisplayArticles() {
// 应用分类过滤
let filtered = state.currentCategory === 'all' 
? [...state.allArticles] 
: state.allArticles.filter(article => article.category === state.currentCategory);

// 应用搜索过滤
if (state.searchTerm) {
const searchLower = state.searchTerm.toLowerCase();
filtered = filtered.filter(article => {
if (state.searchType === 'title' || state.searchType === 'both') {
if (article.title.toLowerCase().includes(searchLower)) return true;
}
if (state.searchType === 'content' || state.searchType === 'both') {
if (article.content.toLowerCase().includes(searchLower)) return true;
}
return false;
});
}

// 更新状态
state.filteredArticles = filtered;
state.totalArticles = filtered.length;
state.totalPages = Math.max(1, Math.ceil(state.totalArticles / config.itemsPerPage));

// 重置页码（如果超出范围）
if (state.currentPage > state.totalPages) {
state.currentPage = 1;
}

// 显示结果
elements.articlesCount.textContent = state.totalArticles;
displayCurrentPageArticles();
updatePagination();

// 显示空状态或文章列表
if (state.totalArticles === 0) {
elements.articlesGrid.innerHTML = '';
elements.emptyState.classList.remove('hidden');
elements.pagination.classList.add('hidden');
} else {
elements.emptyState.classList.add('hidden');
elements.pagination.classList.remove('hidden');
}
}

// 显示当前页的文章
function displayCurrentPageArticles() {
const startIndex = (state.currentPage - 1) * config.itemsPerPage;
const endIndex = Math.min(startIndex + config.itemsPerPage, state.filteredArticles.length);
const currentArticles = state.filteredArticles.slice(startIndex, endIndex);

// 清空网格
elements.articlesGrid.innerHTML = '';

// 添加文章卡片
currentArticles.forEach(article => {
const card = document.createElement('article');
card.className = 'article-card bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition';
card.innerHTML = `
<div class="p-5">
<div class="flex items-center text-xs text-gray-500 mb-2">
<span class="bg-gray-100 px-2 py-0.5 rounded-full">${config.categories[article.category] || article.category}</span>
<span class="ml-2">ID: ${article.id}</span>
</div>
<h3 class="font-semibold text-lg mb-2 line-clamp-2 h-12">${article.title}</h3>
<p class="text-gray-600 text-sm mb-4 line-clamp-3 h-20">${article.content.substring(0, 100)}${article.content.length > 100 ? '...' : ''}</p>
<button class="view-article-btn w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded transition flex items-center justify-center" 
data-category="${article.category}" 
data-id="${article.id}">
<span>阅读全文</span>
<i class="fas fa-arrow-right ml-2"></i>
</button>
</div>
`;
elements.articlesGrid.appendChild(card);

// 添加点击事件
card.querySelector('.view-article-btn').addEventListener('click', async () => {
await viewArticleDetail(article.category, article.id);
});
});
}

// 查看文章详情
async function viewArticleDetail(category, id, forceReload = false) {
// 显示加载状态
elements.articlesSection.classList.add('hidden');
elements.articleDetail.classList.remove('hidden');
elements.detailContentContainer.classList.add('hidden');
elements.detailError.classList.add('hidden');
elements.detailLoading.classList.remove('hidden');

try {
// 加载文章内容
const article = forceReload ? 
await loadArticleContent(category, id) : 
await loadArticleContent(category, id);

// 更新URL
const params = new URLSearchParams();
params.append('category', category);
params.append('id', id);
window.history.pushState({}, '', `?${params.toString()}`);

// 更新UI
elements.detailTitle.textContent = article.title;
elements.detailCategory.textContent = config.categories[category] || category;
elements.detailId.textContent = `ID: ${id}`;

// 渲染内容
await loadMarkedLibrary();
await initMarkedRenderer();
renderArticleContent(article);

// 更新导航按钮
updateArticleNavigation(category, id);

// 隐藏加载状态，显示内容
elements.detailLoading.classList.add('hidden');
elements.detailContentContainer.classList.remove('hidden');

// 更新页面标题
updatePageTitle();

// 滚动到顶部
window.scrollTo(0, 0);

} catch (error) {
console.error('加载文章详情失败:', error);
elements.detailLoading.classList.add('hidden');
elements.detailError.classList.remove('hidden');
elements.detailErrorMessage.textContent = error.message || '无法加载文章内容，请稍后重试';
}
}

// 更新文章导航按钮（上下篇）
function updateArticleNavigation(currentCategory, currentId) {
const currentIndex = state.allArticles.findIndex(
article => article.category === currentCategory && article.id === currentId
);

// 上一篇
if (currentIndex > 0) {
const prevArticle = state.allArticles[currentIndex - 1];
elements.prevArticleBtn.disabled = false;
elements.prevArticleBtn.onclick = async () => {
await viewArticleDetail(prevArticle.category, prevArticle.id);
};
} else {
elements.prevArticleBtn.disabled = true;
elements.prevArticleBtn.onclick = null;
}

// 下一篇
if (currentIndex < state.allArticles.length - 1) {
const nextArticle = state.allArticles[currentIndex + 1];
elements.nextArticleBtn.disabled = false;
elements.nextArticleBtn.onclick = async () => {
await viewArticleDetail(nextArticle.category, nextArticle.id);
};
} else {
elements.nextArticleBtn.disabled = true;
elements.nextArticleBtn.onclick = null;
}
}

// 更新分类按钮状态
function updateCategoryButtons() {
elements.categoryBtns.forEach(btn => {
if (btn.dataset.category === state.currentCategory) {
btn.classList.remove('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700');
btn.classList.add('bg-blue-600', 'text-white');
btn.classList.add('active');
} else {
btn.classList.remove('bg-blue-600', 'text-white', 'active');
btn.classList.add('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700');
}
});
}

// 更新分页控件
function updatePagination() {
// 更新按钮状态
elements.prevPageBtn.disabled = state.currentPage === 1;
elements.nextPageBtn.disabled = state.currentPage === state.totalPages;

// 清空页码容器
elements.pageNumbers.innerHTML = '';

// 生成页码按钮（最多显示5个页码）
let startPage = Math.max(1, state.currentPage - 2);
let endPage = Math.min(state.totalPages, startPage + 4);

// 调整显示范围
if (endPage - startPage < 4 && state.totalPages > 5) {
startPage = Math.max(1, endPage - 4);
}

// 添加第一页按钮（如果当前范围不包含第一页）
if (startPage > 1) {
addPageButton(1);
if (startPage > 2) {
addEllipsis();
}
}

// 添加当前范围内的页码
for (let i = startPage; i <= endPage; i++) {
addPageButton(i);
}

// 添加最后一页按钮（如果当前范围不包含最后一页）
if (endPage < state.totalPages) {
if (endPage < state.totalPages - 1) {
addEllipsis();
}
addPageButton(state.totalPages);
}
}

// 添加页码按钮
function addPageButton(pageNum) {
const button = document.createElement('button');
button.className = `px-3 py-1 rounded transition ${
pageNum === state.currentPage 
? 'bg-blue-600 text-white' 
: 'bg-gray-200 hover:bg-gray-300 text-gray-700'
}`;
button.textContent = pageNum;
button.addEventListener('click', () => {
state.currentPage = pageNum;
displayCurrentPageArticles();
updatePagination();
updateUrl();
window.scrollTo({ top: 0, behavior: 'smooth' });
});
elements.pageNumbers.appendChild(button);
}

// 添加省略号
function addEllipsis() {
const ellipsis = document.createElement('span');
ellipsis.className = 'px-2 text-gray-500';
ellipsis.textContent = '...';
elements.pageNumbers.appendChild(ellipsis);
}

// 处理搜索
function handleSearch() {
const searchTerm = elements.searchInput.value.trim();
state.searchTerm = searchTerm;
state.currentPage = 1;

// 如果有搜索词，添加到搜索历史
if (searchTerm) {
addToSearchHistory(searchTerm);
}

// 过滤并显示结果
filterAndDisplayArticles();
updateUrl();
hideSearchHistory();
}

// 重置搜索
function resetSearch() {
elements.searchInput.value = '';
state.searchTerm = '';
state.currentPage = 1;
elements.searchTypeRadios.forEach(radio => {
radio.checked = radio.value === 'title';
});
state.searchType = 'title';

filterAndDisplayArticles();
updateUrl();
hideSearchHistory();
}

// 显示加载状态
function showLoading(detail) {
elements.articlesSection.classList.add('hidden');
elements.loadingSection.classList.remove('hidden');
if (detail) {
elements.loadingDetail.textContent = detail;
}
}

// 隐藏加载状态
function hideLoading() {
elements.loadingSection.classList.add('hidden');
elements.articlesSection.classList.remove('hidden');
}

// 显示错误信息
function showError(message) {
elements.articlesSection.classList.add('hidden');
elements.errorSection.classList.remove('hidden');
elements.errorMessage.textContent = message;
}

// 隐藏错误信息
function hideError() {
elements.errorSection.classList.add('hidden');
}

// 切换主题（明/暗模式）
function toggleTheme() {
state.darkMode = !state.darkMode;
document.body.classList.toggle('dark-mode', state.darkMode);

// 更新图标
const icon = elements.themeToggle.querySelector('i');
if (state.darkMode) {
icon.classList.remove('fa-moon');
icon.classList.add('fa-sun');
} else {
icon.classList.remove('fa-sun');
icon.classList.add('fa-moon');
}

// 保存偏好
localStorage.setItem('darkMode', state.darkMode ? 'true' : 'false');
}

// 初始化主题
function initTheme() {
const savedMode = localStorage.getItem('darkMode');
if (savedMode === 'true' || 
(!savedMode && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
state.darkMode = true;
document.body.classList.add('dark-mode');
const icon = elements.themeToggle.querySelector('i');
icon.classList.remove('fa-moon');
icon.classList.add('fa-sun');
}
}

// 搜索历史相关功能
function initSearchHistory() {
const savedHistory = localStorage.getItem('searchHistory');
if (savedHistory) {
try {
state.searchHistory = JSON.parse(savedHistory);
renderSearchHistory();
} catch (e) {
console.error('加载搜索历史失败:', e);
state.searchHistory = [];
}
}
}

function addToSearchHistory(term) {
// 移除已存在的相同项
state.searchHistory = state.searchHistory.filter(item => item.term !== term);

// 添加新项
state.searchHistory.unshift({
term,
timestamp: new Date().toISOString()
});

// 限制历史记录数量
if (state.searchHistory.length > config.maxSearchHistory) {
state.searchHistory = state.searchHistory.slice(0, config.maxSearchHistory);
}

// 保存到本地存储
localStorage.setItem('searchHistory', JSON.stringify(state.searchHistory));

// 更新UI
renderSearchHistory();
}

function renderSearchHistory(filterTerm = '') {
elements.historyList.innerHTML = '';

// 过滤历史记录
let filteredHistory = state.searchHistory;
if (filterTerm) {
const lowerFilter = filterTerm.toLowerCase();
filteredHistory = state.searchHistory.filter(item => 
item.term.toLowerCase().includes(lowerFilter)
);
}

// 显示或隐藏空状态
if (filteredHistory.length === 0) {
elements.noHistoryMsg.classList.remove('hidden');
return;
} else {
elements.noHistoryMsg.classList.add('hidden');
}

// 添加历史记录项
filteredHistory.forEach((item, index) => {
const li = document.createElement('li');
li.className = 'history-item';

// 格式化时间
const date = new Date(item.timestamp);
const timeStr = date.toLocaleString();

li.innerHTML = `
<span class="history-text">${item.term}</span>
<span class="history-time">${timeStr}</span>
<span class="remove-history" data-index="${index}">
<i class="fas fa-times"></i>
</span>
`;

// 添加点击事件
li.addEventListener('click', (e) => {
if (!e.target.closest('.remove-history')) {
elements.searchInput.value = item.term;
handleSearch();
}
});

// 添加删除事件
li.querySelector('.remove-history').addEventListener('click', (e) => {
e.stopPropagation();
removeFromSearchHistory(index);
});

elements.historyList.appendChild(li);
});
}

function removeFromSearchHistory(index) {
state.searchHistory.splice(index, 1);
localStorage.setItem('searchHistory', JSON.stringify(state.searchHistory));
renderSearchHistory(elements.searchInput.value.trim());
}

function clearAllSearchHistory() {
state.searchHistory = [];
localStorage.removeItem('searchHistory');
renderSearchHistory();
}

function showSearchHistory() {
elements.searchHistoryDropdown.classList.add('active');
renderSearchHistory(elements.searchInput.value.trim());
}

function hideSearchHistory() {
elements.searchHistoryDropdown.classList.remove('active');
}

function filterSearchHistory() {
const term = elements.searchInput.value.trim();
renderSearchHistory(term);
}

// 初始化应用
async function init() {
// 初始化主题
initTheme();

// 初始化搜索历史
initSearchHistory();

// 绑定事件处理程序
bindEvents();

// 从URL加载状态
loadStateFromUrl();

// 加载Marked.js
await loadMarkedLibrary();
await initMarkedRenderer();

// 加载文章数据
await loadAllArticles();
}

// 启动应用
document.addEventListener('DOMContentLoaded', init);
		

// 滚动控制按钮功能
const backToTopBtn = document.getElementById('back-to-top-btn');
const backToBottomBtn = document.getElementById('back-to-bottom-btn');

// 监听滚动事件，控制按钮显示/隐藏
window.addEventListener('scroll', () => {
const scrollPosition = window.scrollY;
const windowHeight = window.innerHeight;
const documentHeight = Math.max(
document.body.scrollHeight,
document.body.offsetHeight,
document.documentElement.clientHeight,
document.documentElement.scrollHeight,
document.documentElement.offsetHeight
);

// 当滚动超过100px时显示回到顶部按钮
if (scrollPosition > 100) {
backToTopBtn.classList.add('visible');
} else {
backToTopBtn.classList.remove('visible');
}

// 当距离底部超过100px时显示回到底部按钮
if (documentHeight - scrollPosition - windowHeight > 100) {
backToBottomBtn.classList.add('visible');
} else {
backToBottomBtn.classList.remove('visible');
}
});

// 回到顶部功能
backToTopBtn.addEventListener('click', () => {
window.scrollTo({
top: 0,
behavior: 'smooth'
});
});

// 回到底部功能
backToBottomBtn.addEventListener('click', () => {
window.scrollTo({
top: document.body.scrollHeight,
behavior: 'smooth'
});
});		
		
		
</script>

<!--版权说明开始
/*
+------------------------------------------------------------------------+
 System Name : Luhui news Information System V1.0.6
 系统名称 : 鲁虺新闻资讯网 html JavaScript txt V1.0.6
+------------------------------------------------------------------------+
 创建 Created  2025-9-6 / 修改 Modify 2025-9-7
+------------------------------------------------------------------------+
 Version : 1.0.6
+------------------------------------------------------------------------+
 版本更新 : 该版本所有详细更新细节都已在系统迭代说明中详述,如需了解请查阅鲁虺软件文档
 鲁虺软件 : http://soft.luhui.net 点击浏览鲁虺软件开发文档“软件开发”列表查询品鉴
+------------------------------------------------------------------------+
 Author : 鲁虺文化网  冠富研究院  冠富商务通
+------------------------------------------------------------------------+
 Powered by luhui.net 2004-01-11
+------------------------------------------------------------------------+
 QQ : 63625244 
 Email : info@mail.luhui.net
 鲁虺文化网 : http://www.luhui.net
 冠富研究院 : http://www.guanfu.org
 冠富商务通 : http://www.guanfu.net.cn
+------------------------------------------------------------------------+
 Note :

 1.本软件对于非商业用户完全免费,如果要使用在商业用途
   方面,必须取得作者的授权.

 2.你可以任意传播以及修改本程序,但不能以任何形式删除
   本程序的版权.请记住,保留作者版权是对原创作者的尊敬.

 3.如果有问题,可以通过上面提供的方式进行解答,但作者
   时间有限,如果不能及时或者不解答,请谅解.

 4.作者对非法使用该程序导致的问题,不予负责.

 5.本程序版权归 鲁虺文化网 所有.禁止任何侵权行为!

+------------------------------------------------------------------------+
*/
--版权说明结束-->
</body>
</html>
